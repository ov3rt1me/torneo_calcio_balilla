<!DOCTYPE html>
<html lang="it">
<head>
<meta charset="utf-8"/>
<title>Torneo Calcio Balilla</title>
<style>
    /* === LAYOUT GENERALE MODERNO === */
    body {
        font-family: 'Segoe UI', Roboto, Arial, sans-serif;
        margin: 0;
        padding: 24px;
        background: radial-gradient(circle at top, #ffffff 0, #f2f4f8 40%, #e3e7f0 100%);
        color: #222;
    }
    h1 {
        text-align: center;
        font-size: 32px;
        margin-bottom: 10px;
    }
    h2 {
        font-size: 24px;
        margin-top: 30px;
        margin-bottom: 10px;
    }
    h3 {
        font-size: 18px;
        margin-top: 20px;
        margin-bottom: 10px;
    }
    .section {
        margin-top: 30px;
    }
    .footer {
        margin-top: 40px;
        font-size: 0.8rem;
        color: #666;
        text-align: center;
    }

    /* === CARDS SQUADRE - DESIGN MODERNO === */
    .girone-grid {
        display: grid;
        grid-template-columns: repeat(auto-fill, minmax(260px, 1fr));
        gap: 18px;
        margin-bottom: 20px;
    }
    .team-card {
        background: #ffffff;
        border-radius: 16px;
        padding: 14px 16px 16px 16px;
        box-shadow: 0 4px 12px rgba(15, 23, 42, 0.12);
        display: grid;
        grid-template-columns: auto 1fr;
        grid-template-rows: auto auto;
        grid-template-areas:
            "logo info"
            "accordion accordion";
        column-gap: 12px;
        row-gap: 10px;
    }
    .team-card img {
        grid-area: logo;
        width: 56px;
        height: 56px;
        border-radius: 50%;
        object-fit: contain;
        background: #ffffff;
        border: 1px solid #e2e8f0;
    }
    .team-card > div:not(.accordion) {
        grid-area: info;
    }
    .team-name {
        font-weight: 700;
        font-size: 18px;
        margin-bottom: 4px;
    }
    .team-players {
        font-size: 13px;
        color: #4b5563;
        line-height: 1.35;
    }

    /* === TABELLE MODERNE (CALENDARIO / CLASSIFICHE) === */
    table {
        border-collapse: collapse;
        width: 100%;
        margin-bottom: 25px;
        background: #ffffff;
        border-radius: 14px;
        overflow: hidden;
        box-shadow: 0 4px 12px rgba(15, 23, 42, 0.10);
    }
    th, td {
        padding: 8px 10px;
        text-align: center;
        font-size: 14px;
        border-bottom: 1px solid #e5e7eb;
    }
    th {
        background: #eef2ff;
        font-weight: 600;
        color: #111827;
    }
    .calendar-icon {
        font-size: 18px;
    }
    tr:nth-child(even) td {
        background: #f9fafb;
    }
    tr:last-child td {
        border-bottom: none;
    }

    .played { }
    .top2 td:first-child {
        border-left: 4px solid #3b82f6;
        font-weight: 700;
    }
    .last1 td:first-child {
        border-left: 4px solid #f63b51;
        font-weight: 700;
    }

    /* === ACCORDION MODERNO PER LE PARTITE === */
    .accordion {
        grid-area: accordion;
        width: 100%;
        margin-top: 4px;
    }
    .accordion-button {
        cursor: pointer;
        background: #eef1f6;
        border: none;
        width: 100%;
        padding: 9px 12px;
        border-radius: 10px;
        font-size: 14px;
        font-weight: 600;
        text-align: center;
        color: #111827;
        display: inline-flex;
        align-items: center;
        justify-content: center;
        gap: 6px;
        transition: background 0.2s, transform 0.1s;
    }
    .accordion-button::after {
        content: "▾";
        font-size: 12px;
        transition: transform 0.2s;
    }
    .accordion-button.open::after {
        transform: rotate(180deg);
    }
    .accordion-button:hover {
        background: #dde2ea;
    }
    .accordion-button:active {
        transform: translateY(1px);
    }

    .accordion-content {
        display: none;
        margin-top: 10px;
    }

    .match-item {
        padding: 8px 10px;
        margin: 4px 0;
        border-radius: 10px;
        font-size: 13px;
        font-weight: 600;
        color: #111827;
        box-shadow: 0 2px 6px rgba(15, 23, 42, 0.18);
    }

    /* === COLORI PARTITE === */
    .match-green  { background-color: #bbf7d0; }  /* vinta 2-0 */
    .match-red    { background-color: #fecaca; }  /* persa 0-2 */
    .match-yellow { background-color: #fef3c7; }  /* vinta 2-1 */
    .match-orange { background-color: #fed7aa; }  /* persa 1-2 */
</style>

<script>
// Carica automaticamente result.csv
async function caricaCSV(){
  try{
    const r = await fetch('result.csv?cache=' + Date.now());
    if(!r.ok) return;
    const txt = await r.text();
    processCSV(txt);
  }catch(e){
    console.error(e);
  }
}

// Parsing CSV: Squadra1;Squadra2;Gol1;Gol2;Esito;RisultatoText;Aggregato
function processCSV(txt){
  const rows = txt.trim().split(/\r?\n/);
  const map = {};
  rows.forEach((r,i)=>{
    if(!r) return;
    if(i===0 && r.toLowerCase().includes("squadra1")) return; // header
    const c = r.split(";");
    if(c.length < 7) return;
    const key = c[0].trim() + "|" + c[1].trim();
    map[key] = {
      s1: c[0].trim(),
      s2: c[1].trim(),
      gf: parseInt(c[2]) || 0,
      gs: parseInt(c[3]) || 0,
      esito: c[4].trim(),
      txt: c[5].trim(),
      agg: c[6].trim()
    };
  });
  aggiornaCalendarioDaCSV(map);
  aggiornaClassificheDaCSV(map);
  aggiornaAccordionSquadre(map);
}

// Aggiorna calendario: scrive risultato CSV e aggiunge icona stato (⚽ / ⏳)
function aggiornaCalendarioDaCSV(map){
  const tab = document.querySelector("#calendario table");
  if(!tab) return;

  const head = tab.querySelector("tr");
  if(head && !head.querySelector(".risCsv")){
    const thRis = document.createElement("th");
    thRis.className = "risCsv";
    thRis.textContent = "Risultato (CSV)";
    head.appendChild(thRis);

    const thIcon = document.createElement("th");
    thIcon.className = "statoCol";
    thIcon.textContent = "Stato";
    head.appendChild(thIcon);
  }

  tab.querySelectorAll("tr").forEach((row,i)=>{
    if(i===0) return;
    const cells = row.querySelectorAll("td");
    if(cells.length < 3) return;

    const s1 = cells[1].textContent.trim();
    const s2 = cells[2].textContent.trim();
    const key = s1 + "|" + s2;

    let tdRis = row.querySelector(".risCsvCell");
    if(!tdRis){
      tdRis = document.createElement("td");
      tdRis.className = "risCsvCell";
      row.appendChild(tdRis);
    }

    let tdIcon = row.querySelector(".statoCell");
    if(!tdIcon){
      tdIcon = document.createElement("td");
      tdIcon.className = "statoCell calendar-icon";
      row.appendChild(tdIcon);
    }

    const d = map[key];
    const giocata = d && d.agg && d.agg.includes("-");
    if(giocata){
      tdRis.textContent = d.txt;
      tdIcon.textContent = "⚽";
    }else{
      tdRis.textContent = "";
      tdIcon.textContent = "⏳";
    }
  });
}

// Calcola le classifiche dei Gironi A e B
function aggiornaClassificheDaCSV(map){
  const cls = {};
  const init = t => { if(!cls[t]) cls[t] = { punti:0, pg:0, gf:0, gs:0 }; };

  Object.values(map).forEach(g=>{
    init(g.s1);
    init(g.s2);

    // gol fatti/subiti
    cls[g.s1].gf += g.gf;
    cls[g.s1].gs += g.gs;
    cls[g.s2].gf += g.gs;
    cls[g.s2].gs += g.gf;

    const giocata = g.agg && g.agg.includes("-");
    if(giocata){
      cls[g.s1].pg += 1;
      cls[g.s2].pg += 1;
    }

    // punti in base all'Aggregato
    if(g.agg){
      const parts = g.agg.split("-");
      const a = parseInt(parts[0]) || 0;
      const b = parseInt(parts[1]) || 0;

      if(a > b){
        // squadra1 vince
        if(a===2 && b===0){ cls[g.s1].punti += 3; }
        else if(a===2 && b===1){ cls[g.s1].punti += 2; cls[g.s2].punti += 1; }
      }else if(b > a){
        // squadra2 vince
        if(b===2 && a===0){ cls[g.s2].punti += 3; }
        else if(b===2 && a===1){ cls[g.s2].punti += 2; cls[g.s1].punti += 1; }
      }
      // se a==b (es. 1-1) -> 0 punti a entrambe
    }
    // se g.agg vuoto -> 0 punti entrambe (caso A)
  });

  // Costruisci mappa gironi dal calendario
  const gir = {};
  document.querySelectorAll("#calendario table tr").forEach((row,i)=>{
    if(i===0) return;
    const cells = row.querySelectorAll("td");
    if(cells.length < 3) return;
    const gName = cells[0].textContent.trim();
    const s1 = cells[1].textContent.trim();
    const s2 = cells[2].textContent.trim();
    if(!gir[gName]) gir[gName] = new Set();
    gir[gName].add(s1);
    gir[gName].add(s2);
  });

  const tabA = document.getElementById("tabClassificaA");
  const tabB = document.getElementById("tabClassificaB");
  if(tabA) tabA.innerHTML = '<tr><th>Squadra</th><th>Punti</th><th>PG</th><th>GF</th><th>GS</th><th>Diff</th></tr>';
  if(tabB) tabB.innerHTML = '<tr><th>Squadra</th><th>Punti</th><th>PG</th><th>GF</th><th>GS</th><th>Diff</th></tr>';

  function fill(gName, tab){
    if(!tab || !gir[gName]) return;
    const squadre = [...gir[gName]];
    // assicura init per tutte le squadre del girone
    squadre.forEach(t=>init(t));

    squadre.sort((a,b)=>{
      if(cls[b].punti !== cls[a].punti) return cls[b].punti - cls[a].punti;
      const dA = cls[a].gf - cls[a].gs;
      const dB = cls[b].gf - cls[b].gs;
      if(dB !== dA) return dB - dA;
      return cls[b].gf - cls[a].gf;
    });

    squadre.forEach((t,idx)=>{
      const s = cls[t];
      const tr = document.createElement("tr");
      if(idx < 2) tr.classList.add("top2");
      if(idx >= 7) tr.classList.add("last1");
      tr.innerHTML = '<td>'+t+'</td><td>'+s.punti+'</td><td>'+s.pg+'</td><td>'+s.gf+'</td><td>'+s.gs+'</td><td>'+(s.gf-s.gs)+'</td>';
      tab.appendChild(tr);
    });
  }

  fill("Girone A", tabA);
  fill("Girone B", tabB);
}

// === Accordion con le partite per ogni squadra ===
function aggiornaAccordionSquadre(map){
  const partite = Object.values(map);

  document.querySelectorAll(".team-card").forEach(card => {
    const squadraEl = card.querySelector(".team-name");
    if(!squadraEl) return;
    const squadra = squadraEl.textContent.trim();

    // Tolgo eventuale accordion precedente (ricarichi il CSV ogni 60s)
    const oldAcc = card.querySelector(".accordion");
    if(oldAcc) oldAcc.remove();

    // Partite della squadra
    const elenco = partite.filter(g => g.s1 === squadra || g.s2 === squadra);

    if (elenco.length === 0) return;

    const accordion = document.createElement("div");
    accordion.className = "accordion";

    const btn = document.createElement("button");
    btn.className = "accordion-button";
    btn.textContent = "Partite giocate";
    accordion.appendChild(btn);

    const content = document.createElement("div");
    content.className = "accordion-content";

    elenco.forEach(g => {
      const item = document.createElement("div");
      item.className = "match-item";

      // punto di vista della squadra
      let a = 0, b = 0;
      if (g.agg && g.agg.includes("-")) {
        const parts = g.agg.split("-");
        const agg1 = parseInt(parts[0]) || 0;
        const agg2 = parseInt(parts[1]) || 0;
        if (squadra === g.s1) { a = agg1; b = agg2; }
        else { a = agg2; b = agg1; } // invertito per squadra2
      }

      let colore = "";
      if (a === 2 && b === 0) colore = "match-green";      // vinta 2-0
      else if (a === 0 && b === 2) colore = "match-red";   // persa 0-2
      else if (a === 2 && b === 1) colore = "match-yellow";// vinta 2-1
      else if (a === 1 && b === 2) colore = "match-orange";// persa 1-2

      if (colore) item.classList.add(colore);

      const avversario = (squadra === g.s1 ? g.s2 : g.s1);

      // Testo partita (mantengo i dati "globali")
      item.textContent = `${g.s1} ${g.gf}-${g.gs} ${g.s2} (${g.txt}) - Agg: ${g.agg}`;

      content.appendChild(item);
    });

    accordion.appendChild(content);
    card.appendChild(accordion);

    btn.addEventListener("click", () => {
      const visible = content.style.display === "block";
      content.style.display = visible ? "none" : "block";
      btn.classList.toggle("open", !visible);
    });
  });
}

document.addEventListener("DOMContentLoaded", ()=>{
  caricaCSV();
  setInterval(caricaCSV, 60000);
});
</script>
</head>
<body>
<h1>Torneo di Calcio Balilla</h1>
<div class="section" id="gironi">
<h2>Gironi</h2><h3>Girone A (8 squadre)</h3>
<div class="girone-grid"><div class="team-card"><img alt="Logo Piacenza" src="loghi\piacenza.png"/><div><div class="team-name">Piacenza</div><div class="team-players">Attacco: Giada Illuzzi<br/>Difesa: Alessandra Mion</div></div></div><div class="team-card"><img alt="Logo Sassuolo" src="loghi\sassuolo.png"/><div><div class="team-name">Sassuolo</div><div class="team-players">Attacco: Irene Grisi<br/>Difesa: Riccardo Gavioli</div></div></div><div class="team-card"><img alt="Logo Cittadella" src="loghi\cittadella.png"/><div><div class="team-name">Cittadella</div><div class="team-players">Attacco: Matteo Vicentini<br/>Difesa: Paolo Maranini</div></div></div><div class="team-card"><img alt="Logo Salernitana" src="loghi\salernitana.png"/><div><div class="team-name">Salernitana</div><div class="team-players">Attacco: Marco Bonato<br/>Difesa: Matteo Mazzola</div></div></div><div class="team-card"><img alt="Logo Ascoli" src="loghi\ascoli.png"/><div><div class="team-name">Ascoli</div><div class="team-players">Attacco: Carlo Parmegiani<br/>Difesa: Federico Romani</div></div></div><div class="team-card"><img alt="Logo Torino" src="loghi\torino.png"/><div><div class="team-name">Torino</div><div class="team-players">Attacco: Arianna Taccon<br/>Difesa: silvia mariotto</div></div></div><div class="team-card"><img alt="Logo Albinoleffe" src="loghi\albinoleffe.png"/><div><div class="team-name">Albinoleffe</div><div class="team-players">Attacco: Luca Centurioni<br/>Difesa: Simonati Giulia</div></div></div><div class="team-card"><img alt="Logo Mantova" src="loghi\mantova.png"/><div><div class="team-name">Mantova</div><div class="team-players">Attacco: Gianmarco Barbieri<br/>Difesa: Zeno Varalta</div></div></div></div><h3>Girone B (7 squadre)</h3>
<div class="girone-grid"><div class="team-card"><img alt="Logo Padova" src="loghi\padova.png"/><div><div class="team-name">Padova</div><div class="team-players">Attacco: Federico  Mion<br/>Difesa: Chiara Ceschi</div></div></div><div class="team-card"><img alt="Logo Brescia" src="loghi\brescia.png"/><div><div class="team-name">Brescia</div><div class="team-players">Attacco: Camilla Bottacini <br/>Difesa: Nicolò Mirandola </div></div></div><div class="team-card"><img alt="Logo Ancona" src="loghi\ancona.png"/><div><div class="team-name">Ancona</div><div class="team-players">Attacco: Marco Mion<br/>Difesa: Eleonora Bognoli</div></div></div><div class="team-card"><img alt="Logo Modena" src="loghi\modena.png"/><div><div class="team-name">Modena</div><div class="team-players">Attacco: Arianna Bolcato<br/>Difesa: Luciano BonTutto</div></div></div><div class="team-card"><img alt="Logo Crotone" src="loghi\crotone.png"/><div><div class="team-name">Crotone</div><div class="team-players">Attacco: Daniele Mion<br/>Difesa: Elisa Mion</div></div></div><div class="team-card"><img alt="Logo Cesena " src="loghi\cesena.png"/><div><div class="team-name">Cesena </div><div class="team-players">Attacco: Marco Calderaro<br/>Difesa: Mattia Marazzi</div></div></div><div class="team-card"><img alt="Logo Frosinone" src="loghi\frosinone.png"/><div><div class="team-name">Frosinone</div><div class="team-players">Attacco: Andrea Spinapolice<br/>Difesa: Dumitru Coceban</div></div></div></div></div>
<div class="section" id="calendario">
<h2>Calendario</h2>
<table>
<tr>
<th>Girone</th>
<th>Squadra 1</th>
<th>Squadra 2</th>
</tr><tr><td>Girone A</td><td>Torino</td><td>Albinoleffe</td></tr><tr><td>Girone A</td><td>Sassuolo</td><td>Albinoleffe</td></tr><tr><td>Girone A</td><td>Salernitana</td><td>Albinoleffe</td></tr><tr><td>Girone A</td><td>Piacenza</td><td>Mantova</td></tr><tr><td>Girone A</td><td>Salernitana</td><td>Ascoli</td></tr><tr><td>Girone A</td><td>Salernitana</td><td>Mantova</td></tr><tr><td>Girone A</td><td>Piacenza</td><td>Sassuolo</td></tr><tr><td>Girone A</td><td>Cittadella</td><td>Torino</td></tr><tr><td>Girone A</td><td>Sassuolo</td><td>Mantova</td></tr><tr><td>Girone A</td><td>Piacenza</td><td>Albinoleffe</td></tr><tr><td>Girone A</td><td>Sassuolo</td><td>Cittadella</td></tr><tr><td>Girone A</td><td>Piacenza</td><td>Ascoli</td></tr><tr><td>Girone A</td><td>Sassuolo</td><td>Salernitana</td></tr><tr><td>Girone A</td><td>Cittadella</td><td>Salernitana</td></tr><tr><td>Girone A</td><td>Albinoleffe</td><td>Mantova</td></tr><tr><td>Girone A</td><td>Sassuolo</td><td>Ascoli</td></tr><tr><td>Girone A</td><td>Cittadella</td><td>Albinoleffe</td></tr><tr><td>Girone A</td><td>Cittadella</td><td>Ascoli</td></tr><tr><td>Girone A</td><td>Piacenza</td><td>Salernitana</td></tr><tr><td>Girone A</td><td>Sassuolo</td><td>Torino</td></tr><tr><td>Girone A</td><td>Torino</td><td>Mantova</td></tr><tr><td>Girone A</td><td>Ascoli</td><td>Torino</td></tr><tr><td>Girone A</td><td>Piacenza</td><td>Torino</td></tr><tr><td>Girone A</td><td>Piacenza</td><td>Cittadella</td></tr><tr><td>Girone A</td><td>Ascoli</td><td>Mantova</td></tr><tr><td>Girone A</td><td>Ascoli</td><td>Albinoleffe</td></tr><tr><td>Girone A</td><td>Cittadella</td><td>Mantova</td></tr><tr><td>Girone A</td><td>Salernitana</td><td>Torino</td></tr><tr><td>Girone B</td><td>Modena</td><td>Frosinone</td></tr><tr><td>Girone B</td><td>Padova</td><td>Frosinone</td></tr><tr><td>Girone B</td><td>Modena</td><td>Crotone</td></tr><tr><td>Girone B</td><td>Ancona</td><td>Frosinone</td></tr><tr><td>Girone B</td><td>Cesena </td><td>Frosinone</td></tr><tr><td>Girone B</td><td>Padova</td><td>Crotone</td></tr><tr><td>Girone B</td><td>Padova</td><td>Cesena </td></tr><tr><td>Girone B</td><td>Ancona</td><td>Cesena </td></tr><tr><td>Girone B</td><td>Padova</td><td>Ancona</td></tr><tr><td>Girone B</td><td>Crotone</td><td>Cesena </td></tr><tr><td>Girone B</td><td>Brescia</td><td>Frosinone</td></tr><tr><td>Girone B</td><td>Brescia</td><td>Ancona</td></tr><tr><td>Girone B</td><td>Brescia</td><td>Crotone</td></tr><tr><td>Girone B</td><td>Ancona</td><td>Modena</td></tr> <tr><td>Girone B</td><td>Ancona</td><td>Crotone</td></tr><tr><td>Girone B</td><td>Brescia</td><td>Cesena</td></tr><tr><td>Girone B</td><td>Brescia</td><td>Modena</td></tr><tr><td>Girone B</td><td>Brescia</td><td>Padova</td></tr><tr><td>Girone B</td><td>Cesena</td><td>Modena</td></tr><tr><td>Girone B</td><td>Crotone</td><td>Frosinone</td></tr><tr><td>Girone B</td><td>Modena</td><td>Padova</td></tr></table>
</div>
<div class="section" id="regolamento">
<h2>Regolamento</h2>
<ul>
<li>Punteggi: 3 punti vittoria schiacciante (2-0); 2 punti vittoria (2-1); 1 punto sconfitta (1-2); 0 punti sconfitta schiacciante (0-2)</li>
<li>No alle cosiddette "pirlate"</li>
<li>Ganci non ammessi</li>
<li>Formula al meglio delle 3. La vittoria del gioco avviene al sesto goal. Se si arriva allo spareggio (Terzo gioco) allora bisogna vincere con uno scarto di 2 goal (es: sul risultato di 5 pari deve terminare 7-5)</li>
<li>Organizzatevi le partite. Il calendario è puramente indicativo. La fase a gironi deve concludersi il 22 dicembre 2025</li>
</ul>
</div>
<div class="section" id="classificaA"><h2>Classifica Girone A</h2>
<table id="tabClassificaA"><tr><th>Squadra</th><th>Punti</th><th>GF</th><th>GS</th><th>Diff</th></tr></table>
</div>
<div class="section" id="classificaB"><h2>Classifica Girone B</h2>
<table id="tabClassificaB"><tr><th>Squadra</th><th>Punti</th><th>GF</th><th>GS</th><th>Diff</th></tr></table>
</div>
<div class="section" id="fasi_finali">
<h2>Semifinali &amp; Finale</h2>
<h3>Semifinali</h3>
<table>
<tr><th>Match</th><th>Squadra 1</th><th>Squadra 2</th></tr><tr><td>Semifinale 1</td><td>Prima Girone A</td><td>Seconda Girone B</td></tr><tr><td>Semifinale 2</td><td>Prima Girone B</td><td>Seconda Girone A</td></tr> </table>
<h3>Finale</h3>
<table>
<tr><th>Match</th><th>Squadra 1</th><th>Squadra 2</th></tr><tr><td>Finale</td><td>Vincente Semifinale 1</td><td>Vincente Semifinale 2</td></tr></table></div>
<div class="footer">
Torneo di Calcio Balilla - Powered by HTML &amp; JavaScript
</div>
</body>
</html>
