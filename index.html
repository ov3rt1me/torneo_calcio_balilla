<!DOCTYPE html>

<html lang="it">
<head>
<meta charset="utf-8"/>
<title>Torneo Calcio Balilla</title>
<style>
    body { font-family: Arial, sans-serif; margin: 20px; background: #f3f3f3; color: #222; }
    h1, h2, h3 { color: #333; }
    .buttons { margin-bottom: 20px; }
    button {
        margin-right: 10px; margin-bottom: 5px;
        padding: 8px 14px; border-radius: 6px;
        border: 1px solid #888; background: #ffffff;
        cursor: pointer; font-weight: bold;
    }
    button:hover { background: #e6e6e6; }

    .girone-grid {
        display: flex; flex-wrap: wrap; gap: 12px;
        margin-bottom: 20px;
    }
    .team-card {
        background: #ffffff;
        border-radius: 10px;
        padding: 10px;
        display: flex;
        align-items: center;
        box-shadow: 0 2px 4px rgba(0,0,0,0.2);
        min-width: 260px;
    }
    .team-card img {
        width: 50px; height: 50px; margin-right: 10px;
        border-radius: 50%;
        object-fit: contain;
        background: #fff;
    }
    .team-name {
        font-weight: bold; margin-bottom: 4px;
    }
    .team-players {
        font-size: 0.85rem; color: #444;
    }

    table {
        border-collapse: collapse;
        width: 100%;
        margin-bottom: 25px;
        background: #ffffff;
        box-shadow: 0 2px 4px rgba(0,0,0,0.2);
    }
    th, td {
        border: 1px solid #ccc;
        padding: 6px 8px;
        text-align: center;
        font-size: 0.9rem;
    }
    th {
        background: #ddd;
    }
    .section { margin-top: 30px; }
    .footer { margin-top: 40px; font-size: 0.8rem; color: #666; }
    .played{background:#d4ffd4!important;}
    .top2{background:#cce7ff!important;}

    /* === Stili per partite / accordion squadre === */
    .match-green { background-color: #6cc06c; }   /* vinta 2-0 */
    .match-red { background-color: #ff6b6b; }     /* persa 0-2 */
    .match-orange { background-color: #ffa34c; }  /* persa 1-2 */
    .match-yellow { background-color: #fff26b; }  /* vinta 2-1 */

    .match-item {
        padding: 6px 10px;
        margin: 4px 0;
        border-radius: 6px;
        font-size: 14px;
        font-weight: 600;
    }

    .accordion {
        margin-top: 10px;
        width: 100%;
    }

    .accordion-button {
        cursor: pointer;
        background: #e7e7e7;
        border: none;
        width: 100%;
        padding: 8px;
        border-radius: 5px;
        text-align: left;
        font-size: 15px;
        font-weight: bold;
    }

    .accordion-content {
        display: none;
        margin-top: 6px;
    }
</style>

<script>
// Carica automaticamente result.csv
async function caricaCSV(){
  try{
    const r = await fetch('result.csv?cache=' + Date.now());
    if(!r.ok) return;
    const txt = await r.text();
    processCSV(txt);
  }catch(e){
    console.error(e);
  }
}

// Parsing CSV: Squadra1;Squadra2;Gol1;Gol2;Esito;RisultatoText;Aggregato
function processCSV(txt){
  const rows = txt.trim().split(/\r?\n/);
  const map = {};
  rows.forEach((r,i)=>{
    if(!r) return;
    if(i===0 && r.toLowerCase().includes("squadra1")) return; // header
    const c = r.split(";");
    if(c.length < 7) return;
    const key = c[0].trim() + "|" + c[1].trim();
    map[key] = {
      s1: c[0].trim(),
      s2: c[1].trim(),
      gf: parseInt(c[2]) || 0,
      gs: parseInt(c[3]) || 0,
      esito: c[4].trim(),
      txt: c[5].trim(),
      agg: c[6].trim()
    };
  });
  aggiornaCalendarioDaCSV(map);
  aggiornaClassificheDaCSV(map);
  aggiornaAccordionSquadre(map);   // <<--- nuovo
}

// Aggiorna calendario: scrive risultato CSV e colora riga se giocata
function aggiornaCalendarioDaCSV(map){
  const tab = document.querySelector("#calendario table");
  if(!tab) return;

  const head = tab.querySelector("tr");
  if(head && !head.querySelector(".risCsv")){
    const th = document.createElement("th");
    th.className = "risCsv";
    th.textContent = "Risultato (CSV)";
    head.appendChild(th);
  }

  tab.querySelectorAll("tr").forEach((row,i)=>{
    if(i===0) return;
    const cells = row.querySelectorAll("td");
    if(cells.length < 3) return;

    const s1 = cells[1].textContent.trim();
    const s2 = cells[2].textContent.trim();
    const key = s1 + "|" + s2;

    let td = row.querySelector(".risCsvCell");
    if(!td){
      td = document.createElement("td");
      td.className = "risCsvCell";
      row.appendChild(td);
    }

    const d = map[key];
    const giocata = d && d.agg && d.agg.includes("-");
    if(giocata){
      td.textContent = d.txt;
      row.classList.add("played");
    }else{
      td.textContent = "";
      row.classList.remove("played");
    }
  });
}

// Calcola le classifiche dei Gironi A e B
function aggiornaClassificheDaCSV(map){
  const cls = {};
  const init = t => { if(!cls[t]) cls[t] = { punti:0, gf:0, gs:0 }; };

  Object.values(map).forEach(g=>{
    init(g.s1);
    init(g.s2);

    // gol fatti/subiti
    cls[g.s1].gf += g.gf;
    cls[g.s1].gs += g.gs;
    cls[g.s2].gf += g.gs;
    cls[g.s2].gs += g.gf;

    // punti in base all'Aggregato
    if(g.agg){
      const parts = g.agg.split("-");
      const a = parseInt(parts[0]) || 0;
      const b = parseInt(parts[1]) || 0;

      if(a > b){
        // squadra1 vince
        if(a===2 && b===0){ cls[g.s1].punti += 3; }
        else if(a===2 && b===1){ cls[g.s1].punti += 2; cls[g.s2].punti += 1; }
      }else if(b > a){
        // squadra2 vince
        if(b===2 && a===0){ cls[g.s2].punti += 3; }
        else if(b===2 && a===1){ cls[g.s2].punti += 2; cls[g.s1].punti += 1; }
      }
      // se a==b (es. 1-1) -> 0 punti a entrambe
    }
    // se g.agg vuoto -> 0 punti entrambe (caso A)
  });

  // Costruisci mappa gironi dal calendario
  const gir = {};
  document.querySelectorAll("#calendario table tr").forEach((row,i)=>{
    if(i===0) return;
    const cells = row.querySelectorAll("td");
    if(cells.length < 3) return;
    const gName = cells[0].textContent.trim();
    const s1 = cells[1].textContent.trim();
    const s2 = cells[2].textContent.trim();
    if(!gir[gName]) gir[gName] = new Set();
    gir[gName].add(s1);
    gir[gName].add(s2);
  });

  const tabA = document.getElementById("tabClassificaA");
  const tabB = document.getElementById("tabClassificaB");
  if(tabA) tabA.innerHTML = '<tr><th>Squadra</th><th>Punti</th><th>GF</th><th>GS</th><th>Diff</th></tr>';
  if(tabB) tabB.innerHTML = '<tr><th>Squadra</th><th>Punti</th><th>GF</th><th>GS</th><th>Diff</th></tr>';

  function fill(gName, tab){
    if(!tab || !gir[gName]) return;
    const squadre = [...gir[gName]];
    // assicura init per tutte le squadre del girone
    squadre.forEach(t=>init(t));

    squadre.sort((a,b)=>{
      if(cls[b].punti !== cls[a].punti) return cls[b].punti - cls[a].punti;
      const dA = cls[a].gf - cls[a].gs;
      const dB = cls[b].gf - cls[b].gs;
      if(dB !== dA) return dB - dA;
      return cls[b].gf - cls[a].gf;
    });

    squadre.forEach((t,idx)=>{
      const s = cls[t];
      const tr = document.createElement("tr");
      if(idx < 2) tr.classList.add("top2");
      tr.innerHTML = '<td>'+t+'</td><td>'+s.punti+'</td><td>'+s.gf+'</td><td>'+s.gs+'</td><td>'+(s.gf-s.gs)+'</td>';
      tab.appendChild(tr);
    });
  }

  fill("Girone A", tabA);
  fill("Girone B", tabB);
}

// === NUOVO: accordion con le partite per ogni squadra ===
function aggiornaAccordionSquadre(map){
  const partite = Object.values(map);

  document.querySelectorAll(".team-card").forEach(card => {
    const squadra = card.querySelector(".team-name").textContent.trim();

    // Tolgo eventuale accordion precedente (ricarichi il CSV ogni 60s)
    const oldAcc = card.querySelector(".accordion");
    if(oldAcc) oldAcc.remove();

    // Partite della squadra
    const elenco = partite.filter(g => g.s1 === squadra || g.s2 === squadra);

    if (elenco.length === 0) return;

    const accordion = document.createElement("div");
    accordion.className = "accordion";

    const btn = document.createElement("button");
    btn.className = "accordion-button";
    btn.textContent = "Partite giocate";
    accordion.appendChild(btn);

    const content = document.createElement("div");
    content.className = "accordion-content";

    elenco.forEach(g => {
      const item = document.createElement("div");
      item.className = "match-item";

      // punto di vista della squadra
      let a = 0, b = 0;
      if (g.agg && g.agg.includes("-")) {
        const parts = g.agg.split("-");
        const agg1 = parseInt(parts[0]) || 0;
        const agg2 = parseInt(parts[1]) || 0;
        if (squadra === g.s1) { a = agg1; b = agg2; }
        else { a = agg2; b = agg1; } // invertito per squadra2
      }

      let colore = "";
      if (a === 2 && b === 0) colore = "match-green";      // vinta 2-0
      else if (a === 0 && b === 2) colore = "match-red";   // persa 0-2
      else if (a === 2 && b === 1) colore = "match-yellow";// vinta 2-1
      else if (a === 1 && b === 2) colore = "match-orange";// persa 1-2

      if (colore) item.classList.add(colore);

      const avversario = (squadra === g.s1 ? g.s2 : g.s1);

      // Testo partita (mantengo i dati "globali")
      item.textContent = `${g.s1} ${g.gf}-${g.gs} ${g.s2} (${g.txt}) - Agg: ${g.agg}`;

      content.appendChild(item);
    });

    accordion.appendChild(content);
    card.appendChild(accordion);

    btn.addEventListener("click", () => {
      content.style.display = (content.style.display === "block" ? "none" : "block");
    });
  });
}

document.addEventListener("DOMContentLoaded", ()=>{
  caricaCSV();
  setInterval(caricaCSV, 60000);
});
</script>
</head>
<body>
<h1>Torneo di Calcio Balilla</h1>
<div class="section" id="gironi">
<h2>Gironi</h2><h3>Girone A (8 squadre)</h3>
<div class="girone-grid"><div class="team-card"><img alt="Logo Piacenza" src="loghi\piacenza.png"/><div><div class="team-name">Piacenza</div><div class="team-players">Attacco: Giada Illuzzi<br/>Difesa: Alessandra Mion</div></div></div><div class="team-card"><img alt="Logo Sassuolo" src="loghi\sassuolo.png"/><div><div class="team-name">Sassuolo</div><div class="team-players">Attacco: Irene Grisi<br/>Difesa: Riccardo Gavioli</div></div></div><div class="team-card"><img alt="Logo Cittadella" src="loghi\cittadella.png"/><div><div class="team-name">Cittadella</div><div class="team-players">Attacco: Matteo Vicentini<br/>Difesa: Paolo Maranini</div></div></div><div class="team-card"><img alt="Logo Salernitana" src="loghi\salernitana.png"/><div><div class="team-name">Salernitana</div><div class="team-players">Attacco: Marco Bonato<br/>Difesa: Matteo Mazzola</div></div></div><div class="team-card"><img alt="Logo Ascoli" src="loghi\ascoli.png"/><div><div class="team-name">Ascoli</div><div class="team-players">Attacco: Carlo Parmegiani<br/>Difesa: Federico Romani</div></div></div><div class="team-card"><img alt="Logo Torino" src="loghi\torino.png"/><div><div class="team-name">Torino</div><div class="team-players">Attacco: Arianna Taccon<br/>Difesa: silvia mariotto</div></div></div><div class="team-card"><img alt="Logo Albinoleffe" src="loghi\albinoleffe.png"/><div><div class="team-name">Albinoleffe</div><div class="team-players">Attacco: Luca Centurioni<br/>Difesa: Simonati Giulia</div></div></div><div class="team-card"><img alt="Logo Mantova" src="loghi\mantova.png"/><div><div class="team-name">Mantova</div><div class="team-players">Attacco: Gianmarco Barbieri<br/>Difesa: Zeno Varalta</div></div></div></div><h3>Girone B (7 squadre)</h3>
<div class="girone-grid"><div class="team-card"><img alt="Logo Padova" src="loghi\padova.png"/><div><div class="team-name">Padova</div><div class="team-players">Attacco: Federico  Mion<br/>Difesa: Chiara Ceschi</div></div></div><div class="team-card"><img alt="Logo Brescia" src="loghi\brescia.png"/><div><div class="team-name">Brescia</div><div class="team-players">Attacco: Camilla Bottacini <br/>Difesa: Nicolò Mirandola </div></div></div><div class="team-card"><img alt="Logo Ancona" src="loghi\ancona.png"/><div><div class="team-name">Ancona</div><div class="team-players">Attacco: Marco Mion<br/>Difesa: Eleonora Bognoli</div></div></div><div class="team-card"><img alt="Logo Modena" src="loghi\modena.png"/><div><div class="team-name">Modena</div><div class="team-players">Attacco: Arianna Bolcato<br/>Difesa: Luciano BonTutto</div></div></div><div class="team-card"><img alt="Logo Crotone" src="loghi\crotone.png"/><div><div class="team-name">Crotone</div><div class="team-players">Attacco: Daniele Mion<br/>Difesa: Elisa Mion</div></div></div><div class="team-card"><img alt="Logo Cesena " src="loghi\cesena.png"/><div><div class="team-name">Cesena </div><div class="team-players">Attacco: Marco Calderaro<br/>Difesa: Mattia Marazzi</div></div></div><div class="team-card"><img alt="Logo Frosinone" src="loghi\frosinone.png"/><div><div class="team-name">Frosinone</div><div class="team-players">Attacco: Andrea Spinapolice<br/>Difesa: Dumitru Coceban</div></div></div></div></div>
<div class="section" id="calendario">
<h2>Calendario</h2>
<table>
<tr>
<th>Girone</th>
<th>Squadra 1</th>
<th>Squadra 2</th>
</tr><tr><td>Girone A</td><td>Torino</td><td>Albinoleffe</td></tr><tr><td>Girone A</td><td>Sassuolo</td><td>Albinoleffe</td></tr><tr><td>Girone A</td><td>Salernitana</td><td>Albinoleffe</td></tr><tr><td>Girone A</td><td>Piacenza</td><td>Mantova</td></tr><tr><td>Girone A</td><td>Salernitana</td><td>Ascoli</td></tr><tr><td>Girone A</td><td>Salernitana</td><td>Mantova</td></tr><tr><td>Girone A</td><td>Piacenza</td><td>Sassuolo</td></tr><tr><td>Girone A</td><td>Cittadella</td><td>Torino</td></tr><tr><td>Girone A</td><td>Sassuolo</td><td>Mantova</td></tr><tr><td>Girone A</td><td>Piacenza</td><td>Albinoleffe</td></tr><tr><td>Girone A</td><td>Sassuolo</td><td>Cittadella</td></tr><tr><td>Girone A</td><td>Piacenza</td><td>Ascoli</td></tr><tr><td>Girone A</td><td>Sassuolo</td><td>Salernitana</td></tr><tr><td>Girone A</td><td>Cittadella</td><td>Salernitana</td></tr><tr><td>Girone A</td><td>Albinoleffe</td><td>Mantova</td></tr><tr><td>Girone A</td><td>Sassuolo</td><td>Ascoli</td></tr><tr><td>Girone A</td><td>Cittadella</td><td>Albinoleffe</td></tr><tr><td>Girone A</td><td>Cittadella</td><td>Ascoli</td></tr><tr><td>Girone A</td><td>Piacenza</td><td>Salernitana</td></tr><tr><td>Girone A</td><td>Sassuolo</td><td>Torino</td></tr><tr><td>Girone A</td><td>Torino</td><td>Mantova</td></tr><tr><td>Girone A</td><td>Ascoli</td><td>Torino</td></tr><tr><td>Girone A</td><td>Piacenza</td><td>Torino</td></tr><tr><td>Girone A</td><td>Piacenza</td><td>Cittadella</td></tr><tr><td>Girone A</td><td>Ascoli</td><td>Mantova</td></tr><tr><td>Girone A</td><td>Ascoli</td><td>Albinoleffe</td></tr><tr><td>Girone A</td><td>Cittadella</td><td>Mantova</td></tr><tr><td>Girone A</td><td>Salernitana</td><td>Torino</td></tr><tr><td>Girone B</td><td>Modena</td><td>Frosinone</td></tr><tr><td>Girone B</td><td>Padova</td><td>Frosinone</td></tr><tr><td>Girone B</td><td>Modena</td><td>Crotone</td></tr><tr><td>Girone B</td><td>Ancona</td><td>Frosinone</td></tr><tr><td>Girone B</td><td>Cesena </td><td>Frosinone</td></tr><tr><td>Girone B</td><td>Padova</td><td>Crotone</td></tr><tr><td>Girone B</td><td>Padova</td><td>Cesena </td></tr><tr><td>Girone B</td><td>Ancona</td><td>Cesena </td></tr><tr><td>Girone B</td><td>Padova</td><td>Ancona</td></tr><tr><td>Girone B</td><td>Crotone</td><td>Cesena </td></tr><tr><td>Girone B</td><td>Brescia</td><td>Frosinone</td></tr><tr><td>Girone B</td><td>Brescia</td><td>Ancona</td></tr><tr><td>Girone B</td><td>Brescia</td><td>Crotone</td></tr><tr><td>Girone B</td><td>Ancona</td><td>Modena</td></tr> <tr><td>Girone B</td><td>Ancona</td><td>Crotone</td></tr><tr><td>Girone B</td><td>Brescia</td><td>Cesena</td></tr><tr><td>Girone B</td><td>Brescia</td><td>Modena</td></tr><tr><td>Girone B</td><td>Brescia</td><td>Padova</td></tr><tr><td>Girone B</td><td>Cesena</td><td>Modena</td></tr><tr><td>Girone B</td><td>Crotone</td><td>Frosinone</td></tr><tr><td>Girone B</td><td>Modena</td><td>Padova</td></tr></table>
</div>
<div class="section" id="regolamento">
<h2>Regolamento</h2>
<ul>
<li>Punteggi: 3 punti vittoria schiacciante (2-0); 2 punti vittoria (2-1); 1 punto sconfitta (1-2); 0 punti sconfitta schiacciante (0-2)</li>
<li>No alle cosiddette "pirlate"</li>
<li>Ganci non ammessi</li>
<li>Formula al meglio delle 3. La vittoria del gioco avviene al sesto goal. Se si arriva allo spareggio (Terzo gioco) allora bisogna vincere con uno scarto di 2 goal (es: sul risultato di 5 pari deve terminare 7-5)</li>
<li>Organizzatevi le partite. Il calendario è puramente indicativo. La fase a gironi deve concludersi il 22 dicembre 2025</li>
</ul>
</div>
<div class="section" id="classificaA"><h2>Classifica Girone A</h2>
<table id="tabClassificaA"><tr><th>Squadra</th><th>Punti</th><th>GF</th><th>GS</th><th>Diff</th></tr></table>
</div>
<div class="section" id="classificaB"><h2>Classifica Girone B</h2>
<table id="tabClassificaB"><tr><th>Squadra</th><th>Punti</th><th>GF</th><th>GS</th><th>Diff</th></tr></table>
</div>
<div class="section" id="fasi_finali">
<h2>Semifinali &amp; Finale</h2>
<h3>Semifinali</h3>
<table>
<tr><th>Match</th><th>Squadra 1</th><th>Squadra 2</th></tr><tr><td>Semifinale 1</td><td>Prima Girone A</td><td>Seconda Girone B</td></tr><tr><td>Semifinale 2</td><td>Prima Girone B</td><td>Seconda Girone A</td></tr> </table>
<h3>Finale</h3>
<table>
<tr><th>Match</th><th>Squadra 1</th><th>Squadra 2</th></tr><tr><td>Finale</td><td>Vincente Semifinale 1</td><td>Vincente Semifinale 2</td></tr></table></div>
<div class="footer">
</div>
</body>
</html>
